#!/bin/bash

# Elysia 后端系统 API cURL 命令集合
# 所有命令默认使用 localhost:8001，如需修改请替换对应部分

# =========================================
# 管理员接口
# =========================================

# 1. 公共接口（无需认证）

# 1.1 发送注册验证码
curl -X POST \
  http://localhost:8001/api/admin/auth/send-code-register \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000"}'

# 1.2 发送登录验证码
curl -X POST \
  http://localhost:8001/api/admin/auth/send-code-login \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000"}'

# 1.3 短信注册
curl -X POST \
  http://localhost:8001/api/admin/auth/register-sms \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000", "code": "123456"}'

# 1.4 短信登录
curl -X POST \
  http://localhost:8001/api/admin/auth/login-sms \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000", "code": "123456"}'

# 1.5 密码登录
curl -X POST \
  http://localhost:8001/api/admin/auth/login-password \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "admin", "password": "Test@123456"}'

# 2. 受保护接口（需要认证）

# 2.1 创建管理员（请先获取admin_token）
curl -X POST \
  http://localhost:8001/api/admin/create \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN' \
  -d '{"phone_number": "13800138001", "name": "测试管理员", "role": "assistant", "status": "active"}'

# 2.2 获取管理员信息（请先获取admin_id）
curl -X GET \
  "http://localhost:8001/api/admin/get?admin_id=YOUR_ADMIN_ID" \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN'

# 2.3 查询管理员列表
curl -X POST \
  http://localhost:8001/api/admin/list \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN' \
  -d '{"page": 1, "page_size": 10}'

# 2.4 更新密码（请先获取admin_id）
curl -X POST \
  http://localhost:8001/api/admin/update-password \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN' \
  -d '{"admin_id": "YOUR_ADMIN_ID", "old_password": "Test@123456", "new_password": "NewTest@123456"}'

# 2.5 更新状态（请先获取admin_id）
curl -X POST \
  http://localhost:8001/api/admin/update-status \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN' \
  -d '{"admin_id": "YOUR_ADMIN_ID", "status": "inactive"}'

# 2.6 管理员登出
curl -X POST \
  http://localhost:8001/api/admin/auth/logout \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN'

# =========================================
# 学生接口
# =========================================

# 1. 公共接口（无需认证）

# 1.1 发送注册验证码
curl -X POST \
  http://localhost:8001/api/student/auth/send-code-register \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000"}'

# 1.2 发送登录验证码
curl -X POST \
  http://localhost:8001/api/student/auth/send-code-login \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000"}'

# 1.3 短信注册
curl -X POST \
  http://localhost:8001/api/student/auth/register-sms \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000", "code": "123456", "student_number": "S20240001", "password": "Test@123456"}'

# 1.4 短信登录
curl -X POST \
  http://localhost:8001/api/student/auth/login-sms \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000", "code": "123456"}'

# 1.5 密码登录
curl -X POST \
  http://localhost:8001/api/student/auth/login-password \
  -H 'Content-Type: application/json' \
  -d '{"student_number": "S20240001", "password": "Test@123456"}'

# 2. 受保护接口（需要认证）

# 2.1 创建学生（请先获取student_token）
curl -X POST \
  http://localhost:8001/api/student/create \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_STUDENT_TOKEN' \
  -d '{"name": "测试学生", "student_number": "S20240002", "phone_number": "13800138002", "grade": "大一", "major": "计算机科学"}'

# 2.2 获取学生信息（请先获取student_id）
curl -X GET \
  "http://localhost:8001/api/student/get?student_id=YOUR_STUDENT_ID" \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_STUDENT_TOKEN'

# 2.3 更新学生信息（请先获取student_id）
curl -X POST \
  http://localhost:8001/api/student/update \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_STUDENT_TOKEN' \
  -d '{"student_id": "YOUR_STUDENT_ID", "name": "更新后的学生姓名", "email": "updated@test.com"}'

# 2.3 查询学生列表
curl -X POST \
  http://localhost:8001/api/student/list \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_STUDENT_TOKEN' \
  -d '{"page": 1, "page_size": 10}'

# 2.4 更新学习进度（请先获取student_id）
curl -X POST \
  http://localhost:8001/api/student/update-progress \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_STUDENT_TOKEN' \
  -d '{"student_id": "YOUR_STUDENT_ID", "course_id": "C001", "progress": 50, "status": "in_progress"}'

# 2.5 学生登出
curl -X POST \
  http://localhost:8001/api/student/auth/logout \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_STUDENT_TOKEN'

# =========================================
# 教师接口
# =========================================

# 1. 公共接口（无需认证）

# 1.1 教师注册（注意：此接口在/register，不在/api/teacher路径下）
curl -X POST \
  http://localhost:8001/register \
  -H 'Content-Type: application/json' \
  -d '{"name": "测试教师", "phone_number": "13800138000", "employee_number": "T20240001", "email": "teacher@test.com", "password": "Test@123456"}'

# 1.2 发送登录验证码
curl -X POST \
  http://localhost:8001/api/teacher/auth/send-code-login \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000"}'

# 1.3 短信登录
curl -X POST \
  http://localhost:8001/api/teacher/auth/login-sms \
  -H 'Content-Type: application/json' \
  -d '{"phone_number": "13800138000", "code": "123456"}'

# 1.4 密码登录
curl -X POST \
  http://localhost:8001/api/teacher/auth/login-password \
  -H 'Content-Type: application/json' \
  -d '{"employee_number": "T20240001", "password": "Test@123456"}'

# 2. 受保护接口（需要认证）

# 2.1 获取教师信息（请先获取teacher_id和teacher_token）
curl -X GET \
  "http://localhost:8001/api/teacher/get?teacher_id=YOUR_TEACHER_ID" \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_TEACHER_TOKEN'

# 2.2 更新教师信息（请先获取teacher_id）
curl -X POST \
  http://localhost:8001/api/teacher/update \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_TEACHER_TOKEN' \
  -d '{"teacher_id": "YOUR_TEACHER_ID", "name": "更新后的教师姓名", "email": "updated.teacher@test.com"}'

# 2.3 查询教师列表
curl -X POST \
  http://localhost:8001/api/teacher/list \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_TEACHER_TOKEN' \
  -d '{"page": 1, "page_size": 10}'

# 2.4 审核教师（需要admin_token，不是teacher_token）
curl -X POST \
  http://localhost:8001/api/teacher/verify \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN' \
  -d '{"teacher_id": "YOUR_TEACHER_ID", "verify_status": "approved", "verify_remark": "测试审核通过"}'

# 2.5 教师登出
curl -X POST \
  http://localhost:8001/api/teacher/auth/logout \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_TEACHER_TOKEN'

# =========================================
# 教师审批接口
# =========================================

# 1. 教师端审批接口（需要教师认证）

# 1.1 获取教师的审批单（根据教师ID，请先获取teacher_id）
curl -X GET \
  http://localhost:8001/teacher/YOUR_TEACHER_ID/approval \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_TEACHER_TOKEN'

# 1.2 获取审批单详情（根据审批单ID，请先获取approval_id）
curl -X GET \
  http://localhost:8001/teacher/approvals/YOUR_APPROVAL_ID \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_TEACHER_TOKEN'

# 2. 管理员端审批接口（需要管理员认证）

# 2.1 查询审批单列表（管理员）
curl -X GET \
  "http://localhost:8001/admin/teacher/approvals?page=1&page_size=10" \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN'

# 2.2 审批教师（管理员）
curl -X POST \
  http://localhost:8001/admin/teacher/approvals/YOUR_APPROVAL_ID/approve \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN' \
  -d '{"verify_status": "approved", "verify_remark": "测试审核通过"}'

# 2.3 删除审批单（管理员）
curl -X DELETE \
  http://localhost:8001/admin/teacher/approvals/YOUR_APPROVAL_ID \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer YOUR_ADMIN_TOKEN'

# =========================================
# 使用说明
# =========================================

# 1. 服务器地址：默认使用 http://localhost:8001
#    如果服务器运行在其他地址，请替换所有命令中的 localhost:8001

# 2. 测试数据：默认使用以下测试数据
#    - 手机号: 13800138000
#    - 验证码: 123456
#    - 密码: Test@123456
#    - 学号: S20240001
#    - 工号: T20240001

# 3. 认证相关：
#    - 先调用登录接口获取 token（admin_token, student_token, teacher_token）
#    - 从登录响应中获取对应的 ID（admin_id, student_id, teacher_id）
#    - 从教师审批接口中获取 approval_id

# 4. 执行顺序建议：
#    1. 先测试公共接口获取 token
#    2. 再测试需要认证的受保护接口
#    3. 最后测试登出接口

# 5. 导入到 Postman：
#    - 已为您创建了 Postman 集合文件：elysia-api-postman-collection.json
#    - 在 Postman 中点击 Import -> 选择该文件
#    - 所有接口将自动导入，并可使用变量管理

# 6. 调试技巧：
#    - 使用 -v 参数查看详细请求/响应信息
#    - 使用 -i 参数显示响应头
#    - 使用 -o 参数将响应保存到文件

echo "所有cURL命令生成完成！"
echo "共包含 33 个HTTP接口的测试命令。"
echo "请将 YOUR_*_TOKEN 和 YOUR_*_ID 替换为实际值。"